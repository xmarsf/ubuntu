autoinstall:
    version: 1

    identity:
        realname: "Universe"
        username: xmars
        password: "$y$j9T$vhUadnXbgYVxqGcLNthBr0$/xm4vwt.HWOXCQdVm6J3ZVe3buLlleVmEi3K64SGEo2"
        hostname: universe

    packages:
        - docker.io
        - docker-compose-v2

    snaps:
        - name: pycharm
          classic: true
        - name: datagrip
          classic: true
        - name: rustrover
          classic: true
        - name: code
          classic: true
        - name: vault
        - name: bitwarden
        - name: postman
        - name: gitlab
        - name: remmina

    late-commands:
        # Disable unattended upgrades => TODO: enable later after finish installation
        - curtin in-target -- systemctl stop unattended-upgrades
        - curtin in-target -- systemctl disable unattended-upgrades

        # Add curl & libfuse2 (needed for AppImages to run)
        - curtin in-target -- apt-get update
        - curtin in-target -- apt-get install -y curl libfuse2

        # Enable and start Docker
        - curtin in-target -- systemctl enable docker
        - curtin in-target -- systemctl start docker

        # FIXME: check this command first to add user xmars to group, is it work?
        # Add xmars to docker group by editing /etc/group directly
        - sed -i 's/^docker:.*/&,xmars/' /target/etc/group

        # Allow Docker without sudo
        - curtin in-target -- usermod -aG docker xmars

        # Install Rust (latest) via rustup, non-interactive
        - curtin in-target -- sh -c "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y"
        - curtin in-target -- su - xmars -c "$HOME/.cargo/bin/rustup component add rustfmt clippy"

        # Install Hoppscotch (AppImage)
        - curtin in-target -- curl -L https://github.com/hoppscotch/releases/releases/latest/download/Hoppscotch_linux_x64.AppImage -o /opt/hoppscotch.AppImage
        - curtin in-target -- chmod +x /opt/hoppscotch.AppImage
        - curtin in-target -- ln -sf /opt/hoppscotch.AppImage /usr/local/bin/hoppscotch
