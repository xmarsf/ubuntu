autoinstall:
    version: 1

    identity:
        realname: "Universe"
        username: xmars
        password: "$y$j9T$vhUadnXbgYVxqGcLNthBr0$/xm4vwt.HWOXCQdVm6J3ZVe3buLlleVmEi3K64SGEo2"
        hostname: universe

    packages:
        - docker.io
        - docker-compose-v2

    snaps:
        - name: vault

    late-commands:
        # Disable unattended upgrades => TODO: enable later after finish installation
        - curtin in-target -- systemctl stop unattended-upgrades
        - curtin in-target -- systemctl disable unattended-upgrades
        # Enable and start Docker
        - curtin in-target -- systemctl enable docker
        - curtin in-target -- systemctl start docker

        # Allow Docker without sudo
        - curtin in-target -- usermod -aG docker xmars

        # Install Rust (latest) via rustup, non-interactive
        - curtin in-target -- sh -c "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y"
        - curtin in-target -- su - xmars -c "$HOME/.cargo/bin/rustup component add rustfmt clippy"
